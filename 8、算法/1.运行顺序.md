## 一、介绍
JavaScript 是单线程语言，基于事件循环（Event Loop）机制处理异步任务。代码执行顺序：同步代码 → 微任务（Microtask） → 宏任务（Macrotask）。
# 1、微任务可以区分优先级，执行优先级（从高到低）如下：
1. process.nextTick：Node.js 特有，优先级高于微任务；

2. 普通微任务：Promise.then、queueMicrotask、MutationObserver，按加入队列的顺序执行；

# 2、宏任务：
setTimeout、setInterval、setImmediate、requestAnimationFrame、I/O 操作等。其中，process.nextTick 和 setImmediate 是Node.js特有方法，requestAnimationFrame 是浏览器动画相关的宏任务。

## 二、例子
# 1、setTimeout/promise
```js
console.log("start");

// 第一个宏任务，执行完同步代码timeout1后，执行微任务promise1
setTimeout(() => {
  console.log("timeout1");
  Promise.resolve().then(() => console.log("promise1"));
}, 0);

// 第二个宏任务，执行完同步代码timeout2后，执行微任务promise2
setTimeout(() => {
  console.log("timeout2");
  Promise.resolve().then(() => console.log("promise2"));
}, 0);

Promise.resolve().then(() => {
  console.log("promise3");
  setTimeout(() => console.log("timeout3"), 0);
});

console.log("end");
```
输出顺序：
start → end → promise3 → timeout1 → promise1 → timeout2 → promise2 → timeout3


# 2、链式promise
```js
console.log("script start");

setTimeout(() => {
  console.log("setTimeout");
}, 0);

Promise.resolve()
  .then(() => {
    console.log("promise1");
  })
  .then(() => {
    console.log("promise2");
  });

console.log("script end");
```
输出顺序：
script start → script end → promise1 → promise2 → setTimeout
执行微任务队列中的第一个 Promise.then：输出 promise1，触发第二个 then，加入微任务队列。执行第二个 Promise.then：输出 promise2。

# 3、.then
```js
console.log("start");

new Promise((resolve) => {
  console.log("promise1");
  resolve("resolve1");
})
  .then((result) => {
    console.log("then1:", result);  // 微任务1
    return "return1";               // 同步操作（返回一个值）
  })
  .then((result) => {
    console.log("then2:", result);  // 微任务2（由上一步的 return 触发）
    setTimeout(() => {
      console.log("timeout1");      // 宏任务
    }, 0);
  });

console.log("end");
```
输出顺序：
start - promise1 - end - then1:resolve1 - then2:return1 - 